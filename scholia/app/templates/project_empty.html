{% extends "base.html" %}

{% block page_content %}

<h1>Project</h1>

Research projects.


<h2>Examples</h2>

<ul>
  <li><a href="Q27990087">eNanoMapper</a></li>
  <li><a href="Q27949537">EU NanoSafety Cluster</a></li>
  <li><a href="Q52268104">Amyloid fibril cytotoxicity: new insights from novel approaches (AMYTOX)</a>, ERC Advanced Grant</li> 
  <li><a href="Q54514942">Mapping visual cortical regions in awake, behaving monkey using functional mri (MAPAWAMO)</a></li>
  <li><a href="Q54826536">Measuring with no tape</a>, ERC Starting Grant</li>
  <li><a href="Q55089213">High-Definition Tomography</a>, ERC Advanced Grant</li>
</ul>


<h2>Statistics</h2>

<table class="table table-hover" id="statistics"></table>

<h3>Citations per budget</h3>

<table class="table table-hover" id="citations-per-budget"></table>


{% endblock %}



{% block scripts %}
{{super()}}

<script type="text/javascript">

 statisticsSparql = `
SELECT ?count ?description
WITH {
  SELECT (COUNT(*) AS ?count) WHERE { [] wdt:P3400 []. }
} AS %cordis
WITH {
  SELECT (COUNT(*) AS ?count) WHERE { [] wdt:P4870 []. }
} AS %gepris
WHERE {
  {
    INCLUDE %cordis
    BIND("Total number of projects with a CORDIS number" AS ?description)
  }
  UNION
  {
    INCLUDE %gepris
    BIND("Total number of projects with a GEPRIS number" AS ?description)
  }
}
ORDER BY DESC(?count)
`

 citationsPerBudgetSparql = `
SELECT
  ?cites_per_million
  ?citations 
  ?budget ?currency ?currencyLabel
  ?short_name
  ?project ?projectLabel
WITH {
  SELECT
    (COUNT(?citing_work) / ?budget * 1000000 AS ?cites_per_million)
    (COUNT(?citing_work) AS ?citations)
    ?budget ?currency
    ?project
  WHERE {
    ?project p:P2769 / psv:P2769 ?budget_value .
    ?budget_value wikibase:quantityAmount ?budget .
    ?budget_value wikibase:quantityUnit ?currency .
    ?work wdt:P859 ?project .
    ?citing_work wdt:P2860 ?work .
  } 
  GROUP BY ?project ?budget ?currency
} AS %results
WHERE {
  INCLUDE %results
  OPTIONAL { ?project wdt:P1813 ?short_name }
  SERVICE wikibase:label {
    bd:serviceParam wikibase:language "en,da,de,es,fr,jp,nl,no,ru,sv,zh". }
}
ORDER BY DESC(?cites_per_million)
`


 $(document).ready(function() {
     sparqlToDataTable(statisticsSparql, "#statistics");
     sparqlToDataTable(citationsPerBudgetSparql, "#citations-per-budget");
 });

</script>

{% endblock %}

  
