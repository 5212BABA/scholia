{% extends "base.html" %}

{% set aspect = "author" %}

{% block in_ready %}

{{ sparql_to_table('list-of-publications') }}
{{ sparql_to_table('venue-statistics') }}
{{ sparql_to_table('review-statistics') }}
{{ sparql_to_table('topics') }}
{{ sparql_to_table('most-cited-works') }}
{{ sparql_to_table('most-citing-authors') }}
{{ sparql_to_table('events',
     options={
         "linkPrefixes": { "event": "../event/" }
     }
   )
}}
{{ sparql_to_iframe('publications-per-year') }}
{{ sparql_to_iframe('pages-per-year') }}
{{ sparql_to_iframe('topic-scores') }}
{{ sparql_to_iframe('venue-statistics-chart') }}
{{ sparql_to_iframe('coauthors') }}
{{ sparql_to_iframe('coauthor-map') }}
{{ sparql_to_iframe('other-locations') }}
{{ sparql_to_iframe('timeline') }}
{{ sparql_to_iframe('academic-tree') }}
{{ sparql_to_iframe('citations-by-year') }}
{{ sparql_to_iframe('associated-images') }}


{% endblock %}

{% block scripts %}
{{super()}}

<script type="text/javascript" src="{{ url_for('static', filename='d3.v5.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='d3-scale-chromatic.v1.min.js') }}"></script>

<script type="text/javascript">

 function resize() {
     width = document.getElementById("topics-works-matrix").clientWidth;
     d3.select("#topics-works-matrix").attr("width", width);
     console.log("resized with width " + width);
 }


 function sparqlToResponse(sparql, doneCallback) {
     var endpointUrl = "https://query.wikidata.org/bigdata/namespace/wdq/sparql";
     var settings = {
     headers: { Accept: "application/sparql-results+json" },
     data: { query: sparql }
     };
     return $.ajax(endpointUrl, settings).then(doneCallback);
 }

     window.onresize = resize;

     sparql = `
SELECT ?work ?workLabel ?topic ?topicLabel WHERE {
?work wdt:P50 wd:{{ q }} .
?work wdt:P921 ?topic .
OPTIONAL { ?work wdt:P577 ?publication_date }
SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en,cz,da,de,es,fr,hi,jp,nl,nn,ru,sv,zh". }
}
ORDER BY ?publication_date
`;


     sparqlToResponse(sparql, function(response) {
     var data = response.results.bindings;

     var qToLabel = new Object();
     data.forEach(function(item, index) {
         qToLabel[item.topic.value.substring(31)] = item.topicLabel.value || item.topic.value.substring(31);
         qToLabel[item.work.value.substring(31)] = item.workLabel.value || item.work.value.substring(31);
     });

     var works = $.map(data, function(row) {
         return row.work.value.substring(31);
     });
     var topics = $.map(data, function(row) {
         return row.topic.value.substring(31);
     });

     // Sizes
     var margin = { top: 100, right: 0, bottom: 0, left: 0 },
         width =
         document.getElementById("topics-works-matrix").clientWidth,
         axis_height = works.length * 12,
         full_height = axis_height + margin.top;

     var svg = d3
         .select("#topics-works-matrix")
         .append("svg")
         .attr("width", width)
         .attr("height", full_height)
         .append("g")
         .attr("transform", "translate(0, " + margin.top + ")");

     // X scales and axis
     var xScale = d3
         .scaleBand()
         .range([0, width])
         .domain(topics);
     svg
         .append("g")
         .call(
         d3
             .axisTop(xScale)
             .tickSize(0)
             .tickFormat(function(d) {
             return qToLabel[d];
             })
         )
         .selectAll("text")
         .style("text-anchor", "start")
         .attr("transform", "rotate(-65)");

     // Y scales and axis
     var yScale = d3
         .scaleBand()
         .range([0, axis_height])
         .domain(works)

     svg
         .append("g")
         .style("font-size", "16px")
         .style("text-anchor", "start")
         .style("opacity", 0.3)
         .call(
         d3
             .axisLeft(yScale)
             .tickSize(0)
             .tickFormat(function(d) {
             return qToLabel[d];
             })
         )

     // Move y-label slight to the right so the first lette is not cut
         .selectAll("text")
         .attr("x", 1)

     svg.selectAll("g .domain").remove()

     // Tooltip
     var tooltip = d3
         .select("body")
         .append("div")
         .style("opacity", 0)
         .attr("class", "tooltip")
         .style("background-color", "white")
         .style("border", "solid")
         .style("border-width", "2px")
         .style("padding", "10px")
         .style("font-size", "16px");

     var mouseover = function(d) {
         html =
         "<a href='../work/" +
         d.work.value.substring(31) +
         "'>" +
         d.workLabel.value +
         "</a>" +
         "<br/>" +
         "<a href='../topic/" +
         d.topic.value.substring(31) +
         "'>" +
         d.topicLabel.value +
         "</a>";

         tooltip
         .html(html)
         .transition()
         .delay(0)
         .style("opacity", 1)
         .style("left", d3.event.pageX + "px")
         .style("top", d3.event.pageY + "px")
         .style("position", "absolute");
     };
     var inMouseOut = false;
     var mouseout = function(d) {
         tooltip
         .transition()
         .delay(2000)
         .duration(2000)
         .style("opacity", 0);
     };

     // Add elements in matrix
     svg
         .selectAll()
         .data(data, function(d) {
         return true;
         })
         .enter()
         .append("rect")
         .attr("x", function(d) {
         var xIndex = d.topic.value.substring(31);
         var xValue = xScale(xIndex);
         return xValue;
         })
         .attr("y", function(d) {
         var yValue = yScale(d.work.value.substring(31));
         return yValue;
         })
         .attr("width", xScale.bandwidth())
         .attr("height", yScale.bandwidth())
         .style("opacity", 0.5)
         .on("mouseover", mouseover)
         .on("mouseout", mouseout);
     });

</script>

{% endblock %}

{% block page_content %}

<h1 id="h1">Author</h1>
<script type="application/ld+json" id="bioschemas"></script>

<div id="intro"></div>

<div id="wembedder"></div>

<div id="details"></div>

<h2 id="list-of-publications-header">List of publications <a href="{{ url_for('app.show_author_index') }}{{ q }}/latest-works/rss"><img height="24" width="48" src="{{ url_for('static', filename='images/rss-40674_320.png') }}" alt="RSS icon" /></a></h2>

<table class="table table-hover" id="list-of-publications-table"></table>


<!--      SourceMD does currently not work

div>


    Missing publications? 
    {% if first_initial and last_name %}
    <a href="https://query.wikidata.org/#select%20%2a%20where%20%7B%20%3Fwork%20wdt%3AP2093%20%3Fauthorname%20.%20filter%28regex%28%3Fauthorname%2C%20%27%5E{{ first_initial | urlencode }}.%2b{{ last_name | urlencode }}%24%27%29%29%20%7D%20limit%201">Search for unlinked works on Wikidata</a>
    or
    add new ones with <a href="https://sourcemd.toolforge.org/">sourcemd</a>.
    {% else %}
    Add new ones with <a href="https://sourcemd.toolforge.org/">sourcemd</a>.
    {% endif %}
    
</div -->


<h3 id="publications-per-year-header">Number of publications per year</h3>

<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" id="publications-per-year-iframe"></iframe>
</div>


<h3 id="pages-per-year-header">Number of pages per year</h3>

(Only articles with number of pages set are displayed)

<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" id="pages-per-year-iframe"></iframe>
</div>

<h2>Topics</h2>


<h3 id="topic-scores-header">Topic scores</h3>

Topics based on a weighting between fields of work,
topics of authored works and topics of citing works.  

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="topic-scores-iframe"></iframe>
</div>


<h3 id="topics-header">Topics of authored works</h3>

<table class="table table-hover" id="topics-table"></table>

<h3 id="Topics-works matrix">Topics-works matrix</h3>

<div id="topics-works-matrix"></div>


<h2 id="venue-statistics-header">Venue statistics</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="venue-statistics-chart-iframe"></iframe>
</div>

<table class="table table-hover" id="venue-statistics-table"></table>

<h2 id="review-statistics-header">Review statistics</h2>
<p>This author has reviewed for the following journals.</p>
<table class="table table-hover" id="review-statistics-table"></table>

<h2 id="coauthors-header" data-toogle="tooltip" title="Co-author graph for the author (up to 1000 links)">Co-author graph</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="coauthors-iframe"></iframe>
</div>

Are co-authors missing here? You can help curate them via the <a href="{{ url_for('app.show_author_index') }}{{ q }}/curation">curation</a> page.

<h2 id="coauthor-map-header">Co-author map</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="coauthor-map-iframe"></iframe>
</div>


<h2 id="other-locations-header">Other locations</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="other-locations-iframe"></iframe>
</div>


<h2 id="timeline-header">Timeline</h2>


<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" id="timeline-iframe"></iframe>
</div>


<!-- h2>Education</h2>

<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" src="https://query.wikidata.org/embed.html#%23defaultView%3ATimeline%0ASELECT%20%3Feducation%20%3Feducation_label%20%3Feducation_beginning%20%3Feducation_ending%20%3Feducation_degree_label%20WHERE%20%7B%0A%20%20wd%3A{{ q }}%20p%3AP69%20%3Feducation_statement%20.%0A%20%20%3Feducation_statement%20ps%3AP69%20%3Feducation%20.%0A%20%20%3Feducation%20rdfs%3Alabel%20%3Feducation_label%20.%20filter%20%28lang%28%3Feducation_label%29%20%3D%20%27en%27%29%0A%20%20optional%20%7B%20%3Feducation_statement%20pq%3AP580%20%3Feducation_beginning%20.%20%7D%0A%20%20optional%20%7B%20%3Feducation_statement%20pq%3AP582%20%3Feducation_ending%20.%20%7D%0A%20%20optional%20%7B%20%3Feducation_statement%20pq%3AP512%20%3Feducation_degree%20.%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Feducation_degree%20rdfs%3Alabel%20%3Feducation_degree_label%20.%20filter%20%28lang%28%3Feducation_degree_label%29%20%3D%20%27en%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22en,fr,de,ru,es,zh,jp%22.%20%7D%20%20%0A%7D%20"></iframe>
</div>


<h2>Employer/affiliation</h2>

<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" src="https://query.wikidata.org/embed.html#%23defaultView%3ATimeline%0Aselect%20%3Fimage%20%3Faffiliation%20%3Faffiliation_label%20%3Faffiliation_beginning%20%3Faffiliation_ending%20%3Faffiliation_degree_label%20where%20%7B%0A%20%20%7B%20wd%3A{{ q }}%20p%3AP1416%20%3Faffiliation_statement%20.%20%7D%0A%20%20union%20%7B%20wd%3A{{ q }}%20p%3AP108%20%3Faffiliation_statement%20.%20%7D%20%20%23%20actually%20employer%0A%20%20%7B%20%3Faffiliation_statement%20ps%3AP1416%20%3Faffiliation%20.%20%7D%0A%20%20union%20%7B%20%3Faffiliation_statement%20ps%3AP108%20%3Faffiliation%20.%20%7D%0A%20%20%3Faffiliation%20rdfs%3Alabel%20%3Faffiliation_label%20.%20filter%20%28lang%28%3Faffiliation_label%29%20%3D%20%27en%27%29%0A%20%20optional%20%7B%20%3Faffiliation%20wdt%3AP18%20%3Fimage%20%7D%0A%20%20optional%20%7B%20%3Faffiliation_statement%20pq%3AP580%20%3Faffiliation_beginning%20.%20%7D%0A%20%20optional%20%7B%20%3Faffiliation_statement%20pq%3AP582%20%3Faffiliation_ending%20.%20%7D%0A%20%20optional%20%7B%20%3Faffiliation_statement%20pq%3AP512%20%3Faffiliation_degree%20.%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%3Faffiliation_degree%20rdfs%3Alabel%20%3Faffiliation_degree_label%20.%20filter%20%28lang%28%3Faffiliation_degree_label%29%20%3D%20%27en%27%29%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22en%2Cfr%2Cde%2Cru%2Ces%2Czh%2Cjp%22.%20%7D%20%20%0A%7D"></iframe>
</div -->


<h2 id="academic-tree-header">Academic tree</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="academic-tree-iframe"></iframe>
</div>


<h2>Citation statistics</h2>

<h3 id="most-cited-works-header">Most cited works</h3>

Works of the author ordered according to number of citations received.

<table class="table table-hover" id="most-cited-works-table"></table>


<h3 id="citations-by-year-header">Citations by year</h3>

<div class="embed-responsive embed-responsive-16by9">
    <iframe class="embed-responsive-item" id="citations-by-year-iframe"></iframe>
</div>


<h3 id="most-citing-authors-header">Citing authors</h3>

Authors that cite the author (excluding self citations).

<table class="table table-hover" id="most-citing-authors-table"></table>

Are citing authors missing here? You can help curate them via the <a href="{{ url_for('app.show_author_index') }}{{ q }}/curation">curation</a> page.

<h2 id="associated-images-header">Associated images</h2>

<div class="embed-responsive embed-responsive-4by3">
    <iframe class="embed-responsive-item" id="associated-images-iframe"></iframe>
</div>


<h2 id="events-header">Events</h2>

Conferences, workshops and other events the author has attended or otherwise been associated with.

<table class="table table-hover table-striped" id="events-table"></table>

{% endblock %}

